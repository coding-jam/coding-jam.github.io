<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from codingjam.it/controlla-la-tua-applicazione-spring-cloud-con-elastic-stack-a-k-a-elk-parte-1/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 05 Dec 2020 10:22:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="profile" href="http://gmpg.org/xfn/11">
  <link rel="pingback" href="../xmlrpc.php">

  <title>Controlla la tua applicazione Spring Cloud con Elastic Stack (a.k.a ELK) &#8211; Parte 1 &#8211; CodingJam</title>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="CodingJam &raquo; Feed" href="../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="CodingJam &raquo; Comments Feed" href="../comments/feed/index.html" />
<link rel='stylesheet' id='wp-block-library-css'  href='../wp-content/plugins/gutenberg/build/block-library/stylea4fb.css?ver=1591004795' type='text/css' media='all' />
<link rel='stylesheet' id='cookie-law-info-css'  href='../wp-content/plugins/cookie-law-info/public/css/cookie-law-info-public3cf4.css?ver=1.8.8' type='text/css' media='all' />
<link rel='stylesheet' id='cookie-law-info-gdpr-css'  href='../wp-content/plugins/cookie-law-info/public/css/cookie-law-info-gdpr3cf4.css?ver=1.8.8' type='text/css' media='all' />
<link crossorigin="anonymous" rel='stylesheet' id='melissa-google-fonts-css'  href='https://fonts.googleapis.com/css?family=Lato%3A400%2C400i%2C700%2C700i%7CNoto+Serif%3A400%2C400i%2C700%2C700i&amp;subset=latin&amp;ver=1.1.6' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='../wp-content/themes/melissa/css/bootstrap.min7433.css?ver=3.3.7' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-theme-css'  href='../wp-content/themes/melissa/css/bootstrap-theme.min7433.css?ver=3.3.7' type='text/css' media='all' />
<link rel='stylesheet' id='melissa-ie10-viewport-bug-workaround-css'  href='../wp-content/themes/melissa/css/ie10-viewport-bug-workaround8a54.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome-css'  href='../wp-content/themes/melissa/css/font-awesome.min1849.css?ver=4.7.0' type='text/css' media='all' />
<link rel='stylesheet' id='owl-carousel-css'  href='../wp-content/themes/melissa/assets/owl-carousel/owl.carousel3ba1.css?ver=1.3.3' type='text/css' media='all' />
<link rel='stylesheet' id='owl-theme-css'  href='../wp-content/themes/melissa/assets/owl-carousel/owl.theme3ba1.css?ver=1.3.3' type='text/css' media='all' />
<link rel='stylesheet' id='magnific-popup-css'  href='../wp-content/themes/melissa/assets/magnific-popup/magnific-popupf488.css?ver=1.1.0' type='text/css' media='all' />
<link rel='stylesheet' id='melissa-style-css'  href='../wp-content/themes/melissa/style3ec8.css?ver=1.1.6' type='text/css' media='all' />
<style id='melissa-style-inline-css' type='text/css'>

    .bwp-post-media img,
    .bwp-post-carousel-item img,
    .widget_bwp_posts_slider_item img {
      width: 100%;
      margin: 0;
    }
    .bwp-post-wrap:hover {
      margin-top: 0;
      -webkit-box-shadow: 0 4px 0 -2px rgba(46,51,64,0.1);
      -moz-box-shadow: 0 4px 0 -2px rgba(46,51,64,0.1);
      box-shadow: 0 4px 0 -2px rgba(46,51,64,0.1);
    }
    #bwp-masonry-container.no-masonry .bwp-post-wrap:hover {
      top: 0;
    }
    .bwp-no-results-container:hover,
    .bwp-single-article:hover,
    .bwp-featured-media-container:hover,
    .post-navigation .nav-links a:hover,
    .bwp-about-author-container:hover,
    .comment-respond:hover,
    .comment-body:hover,
    #comments .no-comments:hover,
    .comment-navigation .nav-links a:hover,
    .bwp-related-post-wrap:hover,
    .bwp-page-404-container:hover,
    .bwp-sidebar-wrap:hover {
      top: 0;
      -webkit-box-shadow: 0 4px 0 -2px rgba(46,51,64,0.1);
      -moz-box-shadow: 0 4px 0 -2px rgba(46,51,64,0.1);
      box-shadow: 0 4px 0 -2px rgba(46,51,64,0.1);
    }
  #bwp-header-wrap {
    background-color: #2e3340;
  }
  .bwp-header-bg-overlay,
  .bwp-header-rs-bg-overlay {
    background-color: rgba(46, 51, 64, 0.9);
  }
    .bwp-content a,
    .comment-content a,
    .bwp-post-quote a {
      color: #2052bf;
    }
</style>
<link rel='stylesheet' id='enlighter-local-css'  href='../wp-content/plugins/enlighter/resources/EnlighterJS.min9086.css?ver=3.9.0' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jquery4a5f.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var Cli_Data = {"nn_cookie_ids":[],"cookielist":[]};
var log_object = {"ajax_url":"https:\/\/codingjam.it\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/cookie-law-info/public/js/cookie-law-info-public3cf4.js?ver=1.8.8'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://codingjam.it/wp-content/themes/melissa/js/html5shiv.min.js?ver=3.7.3'></script>
<![endif]-->
<!--[if lt IE 9]>
<script type='text/javascript' src='https://codingjam.it/wp-content/themes/melissa/js/respond.min.js?ver=1.4.2'></script>
<![endif]-->
<script type='text/javascript' src='../wp-content/plugins/enlighter/resources/mootools-core-yc9086.js?ver=3.9.0'></script>
<script type='text/javascript' src='../wp-content/plugins/enlighter/resources/EnlighterJS.min9086.js?ver=3.9.0'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel='prev' title='Previous Post' href='../17658-2/index.html' />
<link rel='next' title='Scala 2018 &#8211; Luci ed ombre' href='../scala-2018-luci-ed-ombre/index.html' />
<meta name="generator" content="WordPress 5.4.1" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='https://codingjam.it/?p=15144' />
<link rel="alternate" type="application/json+oembed" href="https://codingjam.it/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcodingjam.it%2Fcontrolla-la-tua-applicazione-spring-cloud-con-elastic-stack-a-k-a-elk-parte-1%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://codingjam.it/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcodingjam.it%2Fcontrolla-la-tua-applicazione-spring-cloud-con-elastic-stack-a-k-a-elk-parte-1%2F&amp;format=xml" />
<link rel="amphtml" href="https://codingjam.it/controlla-la-tua-applicazione-spring-cloud-con-elastic-stack-a-k-a-elk-parte-1/amp/"><script type="text/javascript">/* <![CDATA[ */EnlighterJS_Config = {"selector":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"language":"generic","theme":"droide","indent":2,"hover":"hoverEnabled","showLinenumbers":true,"rawButton":true,"infoButton":false,"windowButton":false,"rawcodeDoubleclick":false,"grouping":true,"cryptex":{"enabled":false,"email":"mail@example.tld"}};!function(){var a=function(a){var b="Enlighter Error: ";console.error?console.error(b+a):console.log&&console.log(b+a)};return window.addEvent?"undefined"==typeof EnlighterJS?void a("Javascript Resources not loaded yet!"):"undefined"==typeof EnlighterJS_Config?void a("Configuration not loaded yet!"):void window.addEvent("domready",function(){EnlighterJS.Util.Init(EnlighterJS_Config.selector.block,EnlighterJS_Config.selector.inline,EnlighterJS_Config)}):void a("MooTools Framework not loaded yet!")}();;/* ]]> */</script><link rel="icon" href="../wp-content/uploads/2018/09/cropped-codingjam-jar-transp-white-big-512-32x32.png" sizes="32x32" />
<link rel="icon" href="../wp-content/uploads/2018/09/cropped-codingjam-jar-transp-white-big-512-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../wp-content/uploads/2018/09/cropped-codingjam-jar-transp-white-big-512-180x180.png" />
<meta name="msapplication-TileImage" content="https://codingjam.it/wp-content/uploads/2018/09/cropped-codingjam-jar-transp-white-big-512-270x270.png" />
</head>

<body class="post-template-default single single-post postid-15144 single-format-standard wp-custom-logo">


<!-- header -->
<header id="bwp-header-wrap" class="bwp-header-simple">

  <!-- header bg -->
    <div class="bwp-header-bg" style="background: url(../wp-content/uploads/2017/07/cropped-P7101915_2.jpg) 50% 0 no-repeat">
    <div class="bwp-header-bg-overlay"></div>

    <!-- header content -->
    <div class="container">
      <div class="bwp-header-content-container">

        <!-- row 1 - logo + navigation -->
        <div class="bwp-main-navigation-container clearfix">

          
        <!-- image logo -->
        <div class="bwp-logo-container">
          <a href="../index.html" class="custom-logo-link" rel="home"><img width="207" height="70" src="../wp-content/uploads/2018/09/cropped-logo-cnj-bianco.png" class="custom-logo" alt="CodingJam" srcset="https://codingjam.it/wp-content/uploads/2018/09/cropped-logo-cnj-bianco.png 207w, https://codingjam.it/wp-content/uploads/2018/09/cropped-logo-cnj-bianco-150x51.png 150w" sizes="(max-width: 207px) 100vw, 207px" /></a>        </div>
        <!-- end image logo -->

        
      <!-- search -->
      <div class="bwp-header-search-container hidden-sm hidden-xs">
        <a href="#" id="bwp-header-search-icon">
          <i class="fa fa-search"></i>
        </a>
        <div class="bwp-dropdown-search-container bwp-search-hidden">
          
<!-- search form -->
<form id="searchform" role="search" method="get" action="https://codingjam.it/">
  <div class="input-group">
    <input type="text" name="s" id="s" class="bwp-search-field form-control" placeholder="Enter your search query...">
    <span class="input-group-btn">
      <button type="submit" class="btn bwp-search-submit">
        <i class="fa fa-search"></i>
      </button>
    </span>
  </div>
</form>
<!-- end search form -->
        </div>
      </div>
      <!-- end search -->

      
      <!-- menu -->
      <div class="bwp-menu-container hidden-sm hidden-xs">
        <nav class="menu-menu-navigation-2-container"><ul id="menu-menu-navigation-2" class="sf-menu"><li id="menu-item-12007" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12007"><a href="#">Programmazione</a>
<ul class="sub-menu">
	<li id="menu-item-12022" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12022"><a href="../category/java/index.html">Java</a></li>
	<li id="menu-item-12009" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12009"><a href="../category/java/java-8/index.html">Java 8</a></li>
	<li id="menu-item-12020" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12020"><a href="../category/rxjava/index.html">RxJava</a></li>
	<li id="menu-item-12017" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12017"><a href="../category/scala/index.html">Scala</a></li>
</ul>
</li>
<li id="menu-item-12006" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12006"><a href="../category/agile/index.html">Agile</a></li>
<li id="menu-item-12005" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12005"><a href="../category/android/index.html">Android</a></li>
<li id="menu-item-12008" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12008"><a href="#">Web</a>
<ul class="sub-menu">
	<li id="menu-item-12014" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12014"><a href="../category/angularjs/index.html">AngularJS</a></li>
	<li id="menu-item-12012" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12012"><a href="../category/ejb/index.html">EJB</a></li>
	<li id="menu-item-12010" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12010"><a href="../category/javascript/index.html">Javascript</a></li>
	<li id="menu-item-12021" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12021"><a href="../category/application-server/jboss/index.html">JBoss</a></li>
	<li id="menu-item-12016" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12016"><a href="../category/jsf/index.html">JSF</a></li>
	<li id="menu-item-12015" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12015"><a href="../category/jquery-2/index.html">jQuery</a></li>
	<li id="menu-item-12019" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12019"><a href="../category/spring-2/index.html">Spring</a></li>
	<li id="menu-item-12018" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12018"><a href="../category/application-server/websphere/index.html">Websphere</a></li>
</ul>
</li>
</ul></nav>      </div>
      <!-- end menu -->

      
      <!-- mobile menu -->
      <div class="bwp-mobile-menu-container hidden-md hidden-lg">
        <!-- mobile menu icon -->
        <a href="#" id="bwp-mobile-menu-icon">
          <i class="fa fa-bars"></i>
        </a>
        <!-- end mobile menu icon -->
        <!-- dropdown mobile menu -->
        <div class="bwp-dropdown-mobile-menu bwp-mobile-menu-hidden">
          <nav class="menu-menu-navigation-2-container"><ul id="menu-menu-navigation-3" class="bwp-mobile-menu list-unstyled"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12007"><a href="#">Programmazione</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12022"><a href="../category/java/index.html">Java</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12009"><a href="../category/java/java-8/index.html">Java 8</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12020"><a href="../category/rxjava/index.html">RxJava</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12017"><a href="../category/scala/index.html">Scala</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12006"><a href="../category/agile/index.html">Agile</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12005"><a href="../category/android/index.html">Android</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12008"><a href="#">Web</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12014"><a href="../category/angularjs/index.html">AngularJS</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12012"><a href="../category/ejb/index.html">EJB</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12010"><a href="../category/javascript/index.html">Javascript</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12021"><a href="../category/application-server/jboss/index.html">JBoss</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12016"><a href="../category/jsf/index.html">JSF</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12015"><a href="../category/jquery-2/index.html">jQuery</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12019"><a href="../category/spring-2/index.html">Spring</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12018"><a href="../category/application-server/websphere/index.html">Websphere</a></li>
</ul>
</li>
</ul></nav>        </div>
        <!-- end dropdown mobile menu -->
      </div>
      <!-- end mobile menu -->

      
        </div>
        <!-- end row 1 - logo + navigation -->

        
          <!-- row 2 - header custom text -->
          <div class="bwp-header-custom-text-container">
            
        <!-- custom text - single page -->
        <h1 class="bwp-header-custom-title entry-title">
          Controlla la tua applicazione Spring Cloud con Elastic Stack (a.k.a ELK) &#8211; Parte 1        </h1>
                <div class="bwp-header-transparent-line clearfix">
          <span class="bwp-header-t-line-1"></span>
          <span class="bwp-header-t-line-2"></span>
        </div>
        <!-- end custom text -->

                  </div>
          <!-- end row 2 - header custom text -->

          
      </div>
    </div>
    <!-- end header content -->
  </div>
  <!-- end header bg -->

  
        <!-- sticky navigation -->
        <div class="bwp-sticky-navigation-wrap bwp-transition-4 clearfix">
          <!-- sticky navigation icon -->
          <a href="#" id="bwp-sticky-navigation-icon">
            <i class="fa fa-bars"></i>
          </a>
          <!-- end sticky navigation icon -->
          <!-- sticky navigation container -->
          <div class="bwp-sticky-navigation-container bwp-sticky-navigation-hidden">
            <nav class="menu-menu-navigation-2-container"><ul id="menu-menu-navigation-4" class="sf-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12007"><a href="#">Programmazione</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12022"><a href="../category/java/index.html">Java</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12009"><a href="../category/java/java-8/index.html">Java 8</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12020"><a href="../category/rxjava/index.html">RxJava</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12017"><a href="../category/scala/index.html">Scala</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12006"><a href="../category/agile/index.html">Agile</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12005"><a href="../category/android/index.html">Android</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12008"><a href="#">Web</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12014"><a href="../category/angularjs/index.html">AngularJS</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12012"><a href="../category/ejb/index.html">EJB</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12010"><a href="../category/javascript/index.html">Javascript</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12021"><a href="../category/application-server/jboss/index.html">JBoss</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12016"><a href="../category/jsf/index.html">JSF</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12015"><a href="../category/jquery-2/index.html">jQuery</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12019"><a href="../category/spring-2/index.html">Spring</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12018"><a href="../category/application-server/websphere/index.html">Websphere</a></li>
</ul>
</li>
</ul></nav>          </div>
          <!-- end sticky navigation container -->
        </div>
        <!-- end sticky navigation -->

        
</header>
<!-- end header -->

  <!-- blog post - single page -->
  <section id="bwp-single-page-wrap">
    <div class="container">
      <div class="bwp-single-page-container" >

        
                  <div class="row"><div class="col-md-8 bwp-single-content-col bwp-sidebar-right"><div class="bwp-single-content-col-wrap" role="main">
        
        <!-- article -->
        <article id="post-15144" class="bwp-single-article bwp-transition-3">

          
  <!-- media - featured image -->
  <figure class="bwp-post-media">
          <a href="../wp-content/uploads/2018/04/elastic-stack.png" class="bwp-popup-image" title="Controlla la tua applicazione Spring Cloud con Elastic Stack (a.k.a ELK) &#8211; Parte 1">
          <img width="1200" height="1301" src="../wp-content/uploads/2018/04/elastic-stack.png" class="attachment-melissa-img-1200-auto size-melissa-img-1200-auto wp-post-image" alt="Elastic Stack" srcset="https://codingjam.it/wp-content/uploads/2018/04/elastic-stack.png 1330w, https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-277x300.png 277w, https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-768x833.png 768w, https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-944x1024.png 944w" sizes="(max-width: 1200px) 100vw, 1200px" />      <span class="bwp-expand-icon bwp-transition-4"><i class="fa fa-expand"></i></span>
    </a>
      </figure>
  <!-- end media -->

  
          <!-- content container -->
          <div class="bwp-single-content">

            <!-- content -->
            <div class="bwp-content entry-content clearfix">
              <p>Nei post precedenti abbiamo visto come è diventato facile (e di moda) creare microservizi nel <a href="../microservizi-in-java-con-spring-boot-e-spring-cloud/index.html" target="_blank" rel="noopener noreferrer">mondo Java con Spring Cloud</a>. La flessibilità che porta questa architettura non è però esente da una maggior complessità, in primis dal punto di vista del <strong>monitoriaggio</strong> del sistema e la <strong>gestione dei log</strong>. <a href="https://codingjam.it/migliora-i-tuoi-log-con-il-mapped-diagnostic-context/" target="_blank" rel="noopener noreferrer">Abbiamo parlato del Mapping Diagnostic Context</a>, che permette di aggiungere &#8220;metadati&#8221; alle singole righe di log, ricordando però che è necessario un <strong>sistema di aggregazione centralizzato</strong> affinché le informazioni acquistino un senso e possano essere analizzate. Tra i più famosi ed usati, sicuramente c&#8217;è lo stack <strong>ElasticSearch, Logstash e Kibana</strong> (<a href="https://www.elastic.co/elk-stack" rel="noopener noreferrer" target="_blank">ELK</a> per gli amici) rebrandizzato oggi come &#8220;<em><strong>Elastic Stack</strong></em>&#8220;. Vediamo gli aspetti base di ELK (ci vorrebbero libri altrimenti), ma soprattutto come configurare la nostra applicazione Java per poter usufruire delle potenzialità che offre.</p>
<h2>C&#8217;era una volta ElasticSearch, Logstash e Kibana&#8230; e Beats!</h2>
<p>La <a href="https://www.elastic.co/elk-stack" rel="noopener noreferrer" target="_blank">homepage</a> spiega in pochi step come siamo arrivati oggi a parlare di <strong>Elastic Stack</strong>. Si tratta di uno stack perché fondamentalmente sono 4 prodotti, ognuno con un compito specifico, che collaborano l&#8217;uno con l&#8217;altro.</p>
<p>Tutto è nato da <a href="https://www.elastic.co/products/elasticsearch" rel="noopener noreferrer" target="_blank"><strong>ElasticSearch</strong></a>, un motore di <strong>analisi e ricerca distribuito</strong>, basato su NoSQL e <a href="https://lucene.apache.org/core/" rel="noopener noreferrer" target="_blank">Lucene</a>, con interfaccia REST e scambio di documenti JSON. </p>
<p>Ben presto è stato ritenuto un buono strumento per <strong>raccogliere i log di sistemi distribuiti</strong>: mancava solo un sistema capace di <strong>leggere i log e trasformarli in documenti JSON</strong> da dare in pasto ad ElasticSearch. E&#8217; così che nasce <a href="https://www.elastic.co/products/logstash" rel="noopener noreferrer" target="_blank"><strong>Logstash</strong></a>. Sostanzialmente si tratta di un <a href="https://it.wikipedia.org/wiki/Extract,_transform,_load" rel="noopener noreferrer" target="_blank">ETL</a> che è capace di ricevere i log da <a href="https://www.elastic.co/guide/en/logstash/current/input-plugins.html" rel="noopener noreferrer" target="_blank">fonti diverse</a> (TPC, UDP, file, JMS, JDBC, Redis, Kafka&#8230;), trasformarli ed aggregarli tramite l&#8217;<a href="https://www.elastic.co/guide/en/logstash/current/filter-plugins.html" rel="noopener noreferrer" target="_blank">applicazione di filtri</a>, ed infine inviare il risultato in uno &#8220;<em>stash</em>&#8220;, in una <a href="https://www.elastic.co/guide/en/logstash/current/output-plugins.html" rel="noopener noreferrer" target="_blank">destinazione</a>, tra le quali ovviamente c&#8217;è ElasticSearch!</p>
<p>Che fare però di questi dati se non possono essere estratti, richiesti o aggregati facilmente? Era necessario un <strong>tool di visualizzazione flessibile e potete</strong>: <a href="https://www.elastic.co/products/kibana" rel="noopener noreferrer" target="_blank"><strong>Kibana</strong></a> vede la luce e diventa l&#8217;interfaccia ideale per ElasticSearch, permettendo di creare grafici e dashboard in modo intuitivo a partire dai dati, sfruttando tutti gli strumenti di aggregazione e ricerca di ElasticSearch per produrre istogrammmi, grafici a torta, geolocalizzare le informazioni e così via.</p>
<p>Lo stack nel tempo è diventato complesso e certe volte sembra aver perso l&#8217;immediatezza iniziale. Alla fine, il primo grande uso che se ne vuol fare è sempre l&#8217;aggregatore di log: manca quindi un semplice &#8220;<em>trasportatore</em>&#8221; di log che li prelevi dalle nostre applicazioni e li faccia entrare nello stack. Nasce quindi un quarto elemento, o meglio una <strong>famiglia di prodotti specifici nel trasporto di log</strong> (ma non solo) chiamati <a href="https://www.elastic.co/products/beats" rel="noopener noreferrer" target="_blank"><strong>Beats</strong></a>. Non sono altro che agenti da installare come &#8220;sidecar&#8221; delle nostre applicazioni, solitamente a livello di server, che hanno il compito di raccogliere i dati ed inviarli a Logstash o direttamente a ElasticSearch.</p>
<p>Per questo lo stack in realtà oggi dovrebbe chiamarsi BELK, BLEK o ELKB&#8230; per evitare problemi hanno giustamente optato per un brand più generico, cioè <strong>Elastic Stack</strong>!</p>
<div class="text-center">
<a href="../wp-content/uploads/2018/04/elastic-stack.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-277x300.png" alt="Elastic Stack" width="277" height="300" class="aligncenter size-medium wp-image-15147" srcset="https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-277x300.png 277w, https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-768x833.png 768w, https://codingjam.it/wp-content/uploads/2018/04/elastic-stack-944x1024.png 944w, https://codingjam.it/wp-content/uploads/2018/04/elastic-stack.png 1330w" sizes="(max-width: 277px) 100vw, 277px" /></a>
</div>
<h2>Architettura</h2>
<p>Abbiamo quindi conosciuto i 4 elementi dello stack, ma <em>in che relazione stanno tra loro</em>? A livello teorico (a.k.a. &#8220;fuffa ad alto livello&#8221;), il flusso di elaborazione dei dati segue questo schema:</p>
<div class="text-center">
<a href="https://codingjam.it/wp-content/uploads/2018/04/elastic_stack_flow.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/04/elastic_stack_flow-300x111.png" alt="Elastic Stack Data Flow" width="300" height="111" class="aligncenter size-medium wp-image-15158" srcset="https://codingjam.it/wp-content/uploads/2018/04/elastic_stack_flow-300x111.png 300w, https://codingjam.it/wp-content/uploads/2018/04/elastic_stack_flow.png 698w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>Le informazioni <strong>entrano da <em>Beats</em> e/o <em>Logstash</em></strong>, vengono <strong>indicizzate da <em>ElasticSearch</em></strong>, e si <strong>visualizzano con <em>Kibana</em></strong>. Mentre il ruolo degli ultimi due strati dello stack è chiaro, quello dei primi due all&#8217;inizio può sembrare confusionario: i dati possono entrare in entrambi, ma volendo Beats può girarli sia a Logstash che ElasticSearch&#8230; perché? Beats è nato dopo Logstash per <strong>semplificare e alleggerire</strong> il footprint delle operazioni di trasporto dei log nello stack, nonché di raccolta delle metriche dei sistemi distribuiti. Beats infatti è una famiglia di prodotti che non è solo incentrata sui log, ma permette di raccogliere informazioni più a <strong>basso livello per monitorare</strong> lo stato di salute del nostro sistema distribuito.<br />
Vediamo di seguito qualche esempio su come implementare questa architettura per capirne le differenze e i vantaggi.</p>
<h3>Come implementare l&#8217;architettura Elastic Stack</h3>
<p>Partiamo da una delle <a href="https://hub.docker.com/r/sebp/elk/" rel="noopener noreferrer" target="_blank">immagini Docker</a> più scaricate e <a href="http://elk-docker.readthedocs.io/" rel="noopener noreferrer" target="_blank">ben documentate</a>: in un unico container abbiamo a disposizione tutto lo stack, valido almeno per un ambiente di test (anche se è già pronto per <a href="http://elk-docker.readthedocs.io/#setting-up-an-elasticsearch-cluster" rel="noopener noreferrer" target="_blank">architetture più complesse</a>).</p>
<p>Cominceremo quindi da una architettura base, per poi successivamente preoccuparci dello stress del sistema e dell&#8217;alta affidabilità.</p>
<p>Su GitHub sono disponibili 2 progetti, usati per scrivere questo post: uno con le <em>customizzazioni</em> apportate al container <tt>sebp/elk</tt> (<a href="https://github.com/coding-jam/elk-poc" rel="noopener noreferrer" target="_blank">elk-poc</a>); un altro è il <a href="https://github.com/coding-jam/spring-cloud-poc" rel="noopener noreferrer" target="_blank">POC di Spring Cloud</a> già visto in un <a href="../microservizi-in-java-con-spring-boot-e-spring-cloud/index.html" rel="noopener noreferrer" target="_blank">precedente post</a>, riadattato (in <em>branch separati</em>) per dialogare con ELK in diverse modalità.</p>
<h3>Lettura diretta dal file di log</h3>
<p>Logstash è uno strumento estremamente versatile: grazie alla miriade di plugin di <em>input</em>, <em>filtering</em> e <em>output</em>, è possibile realizzare diverse <a href="https://www.elastic.co/guide/en/logstash/current/pipeline.html" rel="noopener noreferrer" target="_blank">pipeline di processazione</a> per distinguere le sorgenti e le elaborazioni (solitamente l&#8217;output rimane ElasticSearch, ma non è detto&#8230;)</p>
<div class="text-center">
<a href="https://codingjam.it/wp-content/uploads/2018/04/logstash.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/04/logstash-300x164.png" alt="Logstash" width="300" height="164" class="aligncenter size-medium wp-image-15177" srcset="https://codingjam.it/wp-content/uploads/2018/04/logstash-300x164.png 300w, https://codingjam.it/wp-content/uploads/2018/04/logstash-768x420.png 768w, https://codingjam.it/wp-content/uploads/2018/04/logstash.png 782w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>Il flusso più semplice che possiamo realizzare è <strong>far leggere direttamente a Logstash i nostri log</strong>, nel classico formato di testo &#8220;plain&#8221;, secondo questo schema:</p>
<div class="text-center">
<a href="https://codingjam.it/wp-content/uploads/2018/04/elk-base.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/04/elk-base-300x81.png" alt="ELK Base" width="300" height="81" class="aligncenter size-medium wp-image-15165" srcset="https://codingjam.it/wp-content/uploads/2018/04/elk-base-300x81.png 300w, https://codingjam.it/wp-content/uploads/2018/04/elk-base.png 748w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>In questa configurazione, Logstash assume il ruolo fondamentale di <strong>collettore</strong>, <strong>elaboratore</strong> e &#8220;<strong>dispatcher</strong>&#8221; di log e <strong>risiede sulla macchina dove girano le applicazioni</strong> (a differenza di ElasticSearch e Kibana).</p>
<h4>Logstash e le pipeline</h4>
<p><a href="https://www.elastic.co/blog/logstash-multiple-pipelines" rel="noopener noreferrer" target="_blank">Poco meno di un anno fa</a> è stato introdotto in Logstash il concetto di <strong>pipeline multiple</strong>: si tratta cioè di poter dichiarare nella stessa istanza di Logstash <em>più flussi &#8220;ETL&#8221; separati</em>. Prima infatti o si istanziava più volte Logstash con configurazioni diverse, oppure si faceva un&#8217;unica configurazione piena di &#8220;<tt>if</tt>&#8220;&#8230; Adesso è tutto molto più semplice e manutenibile.</p>
<p>Basta compilare il file chiamato <tt><a href="https://github.com/coding-jam/elk-poc/blob/master/conf/pipelines.yml" rel="noopener noreferrer" target="_blank">pipelines.yml</a></tt> (che nel nostro container risiede in <tt>/opt/logstash/config</tt>) con i riferimenti alla configurazione da usare:</p>
<pre>
- pipeline.id: spring-cloud-poc-file-plain
  pipeline.batch.size: 1
  path.config: /etc/logstash/conf.d/{input-file-plain.conf,filter-output-plain.conf}
  queue.type: persisted
</pre>
<ol>
<dt><tt>pipeline.id</tt></dt>
<dd>identificativo univoco della pipeline</dd>
<dt><tt>pipeline.batch.size</tt></dt>
<dd>quanti elementi accumulare nel plugin di <strong>input</strong> prima di passarli agli &#8220;<em>worker</em>&#8221; del <strong>filtering</strong> e <strong>output</strong></dd>
<dt><tt>path.config</tt></dt>
<dd>path assoluto delle configurazioni da usare per la pipeline. Supporta la <a href="https://en.wikipedia.org/wiki/Glob_(programming)" rel="noopener noreferrer" target="_blank">sintassi glob</a> (in questo caso la configurazione è formata da due file, così da essere condivisa con altre pipeline)</dd>
<dt><tt>queue.type</tt></dt>
<dd>tipo di coda che gestisce i batch di dati. Una <a href="https://www.elastic.co/guide/en/logstash/current/persistent-queues.html">coda persistente</a> permette di salvare i messaggi ricevuti in fase di input (prima di essere elaborati) in modo da fare buffering e non perdere nessuna messaggio in caso di sovraccarico</dd>
</ol>
<p>Queste sono solo le opzioni più frequenti: l&#8217;elenco completo è disponibile come commento all&#8217;interno del file. Scendiamo ora nel <strong>cuore della pipeline</strong>, ovvero i 3 step di <strong>intput</strong>, <strong>filtering</strong> e <strong>output</strong>.</p>
<div class="text-center">
<a href="https://codingjam.it/wp-content/uploads/2018/04/logstash-conf.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/04/logstash-conf-300x237.png" alt="" width="300" height="237" class="aligncenter size-medium wp-image-15187" srcset="https://codingjam.it/wp-content/uploads/2018/04/logstash-conf-300x237.png 300w, https://codingjam.it/wp-content/uploads/2018/04/logstash-conf-768x608.png 768w, https://codingjam.it/wp-content/uploads/2018/04/logstash-conf.png 950w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<h5>Input</h5>
<p>Il file <tt><a href="https://github.com/coding-jam/elk-poc/blob/master/conf/input-file-plain.conf" rel="noopener noreferrer" target="_blank">input-file-plain.conf</a></tt> configura il plugin <strong><a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html" rel="noopener noreferrer" target="_blank">file</a></strong> in modo che <strong>legga direttamente i nostri log</strong></p>
<p><pre data-enlighter-language="ruby" class="EnlighterJSRAW">
input {
    file {
        path =&gt; &quot;/logs/*/*/*/*.log&quot;
        codec =&gt; multiline {
            pattern =&gt; &quot;^%{YEAR}-%{MONTHNUM}-%{MONTHDAY} %{TIME}.*&quot;
            negate =&gt; &quot;true&quot;
            what =&gt; &quot;previous&quot;
        }
    }
}
</pre></p>
<p>E&#8217; obbligatorio specificare il <tt>path</tt> del file (sempre in sintassi glob). Per supportare <em>anche il multiriga</em> (per gli stacktrace) e necessario aggiungere il <tt>codec multiline</tt> opportunamente configurato: ogni riga comincia con una data (<tt>pattern</tt> di default dei log di Spring Boot, come suggerito da questo <a href="http://knes1.github.io/blog/2015/2015-08-16-manage-spring-boot-logs-with-elasticsearch-kibana-and-logstash.html" rel="noopener noreferrer" target="_blank">splendido post</a>); se non è così (<tt>negate => "true"</tt>), va raggruppata con la precedente (<tt>what => "previous"</tt>).</p>
<h5>Filter</h5>
<p>Dal momento che stiamo <em>leggendo del log non strutturati</em> (puro testo), è necessario <strong>dar loro una semantica</strong>. La vera potenza di Logstash sta proprio in questa fase, grazie al plugin <a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok.html" rel="noopener noreferrer" target="_blank">grok</a> (che possiamo tradurre come &#8220;buttar giù&#8221;, &#8220;decifrare&#8221;). Il suo scopo è &#8220;tokenizzare&#8221; il log in modo da creare una struttura (json) valorizzata con i token estratti.</p>
<p>Il plugin non fa altro che usare <strong>massicciamente espressioni regolari</strong>, mascherate con una dose di zucchero sintattico del tipo <tt>%{SYNTAX:SEMANTIC}</tt>:</p>
<ul>
<li><tt>SYNTAX</tt> fa riferimento ad una espressione regolare</li>
<li><tt>SEMANTIC</tt> definisce il nome della variabile (chiamata anche <tt>field</tt> o campo) che contiene il valore del pattern trovato (come se fosse il gruppo &#8220;matchato&#8221; in una espressione regolare)
</ul>
<p>Ci vorrebbe un post dedicato al grok, ma per farsi un&#8217;idea basta un esempio. Il seguente log</p>
<pre>
GET /login 0.241ms
</pre>
<p>è catturato dal pattern:</p>
<pre>
%{WORD:method} %{URIPATHPARAM:request} %{NUMBER:duration}ms
</pre>
<p>che genera un json con i seguenti <tt>field</tt></p>
<p><pre data-enlighter-language="json" class="EnlighterJSRAW">
{
   &quot;method&quot;: &quot;GET&quot;,
   &quot;request&quot;: &quot;/login&quot;,
   &quot;duration&quot;: &quot;0.241&quot;
}
</pre></p>
<p>Non è un caso che i valori trovati <strong>siano tutti dichiarati come stringhe</strong>, vedremo dopo come specificarne il tipo.</p>
<p>Da dove vengono fuori <tt>WORD</tt>, <tt>URIPATHPARAM</tt> e <tt>NUMBER</tt>? Grok dispone di un <a href="https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns" rel="noopener noreferrer" target="_blank">ricco vocabolario già pronto</a> di espressioni regolari, ma che è molto facile estendere.</p>
<p>Per esempio, i pattern Grok necessari a matchare i log di <strong>Spring Boot + <a href="https://spring.io/blog/2016/02/15/distributed-tracing-with-spring-cloud-sleuth-and-spring-cloud-zipkin" rel="noopener noreferrer" target="_blank">Sleuth</a></strong>, usati in questo POC, sono definiti <a href="https://github.com/coding-jam/elk-poc/blob/master/conf/patterns/spring-boot" rel="noopener noreferrer" target="_blank">in un file a parte</a>, <strong>da specificare nella configurazione del plugin</strong>. </p>
<p>Per imparare ad usare grok è molto utile poter testare i pattern (anche quelli propri) direttamente online grazie all&#8217;applicazione <a href="https://grokdebug.herokuapp.com/" rel="noopener noreferrer" target="_blank">Grok Debugger</a> o ai DevTools di <a href="https://www.elastic.co/products/x-pack">X-Pack</a> (incluso dalla <a href="https://www.elastic.co/blog/elastic-stack-6-3-0-released">6.3</a>).</p>
<p>Fatta questa premessa, la dichiarazione del plugin <tt>grok</tt> all&#8217;interno del <tt>filter</tt> non dovrebbe risultare misteriosa:</p>
<p><pre data-enlighter-language="ruby" class="EnlighterJSRAW">
filter {
  grok {
    patterns_dir =&gt; [&quot;/etc/logstash/conf.d/patterns&quot;]
    named_captures_only =&gt; true
    match =&gt; {
        &quot;message&quot; =&gt; [
            &quot;%{SB_LAYOUT}: %{GREEDYDATA:message}&quot;
        ]
    }
    overwrite =&gt; [ &quot;message&quot; ]
  }
}
</pre></p>
<p>Specifichiamo la cartella con i nostri pattern (<tt>patterns_dir</tt>); dichiariamo che vogliamo una entry nel json solo per i pattern che <strong>hanno un nome</strong> (<tt>named_captures_only</tt>), cioè che hanno specificato il nome del <tt>field</tt> a destra dei due punti (<tt>:SEMANTIC</tt>) del pattern; con <tt>match</tt> invece dichiariamo i possibili pattern del campo &#8220;<tt>message</tt>&#8221; ricevuto in input dal plugin <strong>file</strong>. In pratica tutto quello matchato da <tt>SB_LAYOUT</tt> è il layout (custom) del log di Spring Boot (non ci interessa dargli un nome in questo caso, perché i &#8220;sotto layout&#8221; già definiscono i nomi dei <tt>field</tt> per le singole parti): a destra c&#8217;è il messaggio vero e proprio del nostro log, catturato dal <tt>field</tt> &#8220;<tt>message</tt>&#8220;.</p>
<p>Alla fine vogliano che la <strong>nuova variabile</strong> &#8220;<tt>message</tt>&#8220;, cioè il <em>nostro messaggio di log vero e proprio estratto dal layout di Spring Boot</em>, sovrascriva (<tt>overwrite</tt>) quella ricevuta in input.</p>
<p>Se infatti il &#8220;<tt>message</tt>&#8221; ricevuto in input dal plugin <strong>file</strong> è:</p>
<pre>
2018-04-22 18:53:45.691  INFO [order-services,ed5a486181943259,ed5a486181943259,false] 2062 --- [nio-9191-exec-5] i.c.filters.mdc.UriMetricsLoggerFilter   : Searching customer by id 1
</pre>
<p>in uscita dal <strong>grok</strong> avremo il json del tipo:</p>
<p><pre data-enlighter-language="json" class="EnlighterJSRAW">
{
  &quot;timestamp&quot;: &quot;2018-04-22 18:53:45.691&quot;,
  &quot;level&quot;: &quot;INFO&quot;,
  &quot;service_name&quot;: &quot;order-services&quot;,
  &quot;trace&quot;: &quot;ed5a486181943259&quot;,
  &quot;span&quot;: &quot;ed5a486181943259&quot;,
  &quot;export&quot;: &quot;false&quot;,
  &quot;pid&quot;: &quot;2062&quot;,
  &quot;thread&quot;: &quot;nio-9191-exec-5&quot;,
  &quot;class&quot;: &quot;i.c.filters.mdc.UriMetricsLoggerFilter&quot;,
  &quot;message&quot;: &quot;Searching customer by id 1&quot;
}
</pre></p>
<p>il cui campo &#8220;<tt>message</tt>&#8221; è il testo vero e proprio che abbiamo scritto nel nostro codice.</p>
<p>Di per sé questo sarebbe sufficiente per avere una prima indicizzazione da parte di ElasticSearch. Ma nel momento in cui andiamo ad usare Kibana ci accorgiamo che qualcosa non quadra. Il <tt>timestamp</tt> degli eventi non torna con quello mostrato nel nostro file di log: non sapendo infatti quale variabile del nostro pattern rappresenta il tempo, Logstash <strong>ne genera uno automaticamente</strong>: è ovvio quindi che questo tempo <strong>non è quello del nostro log</strong>, ma quello di <strong>quando viene processata la riga</strong> (che può essere potenzialmente in differita).</p>
<p>Prima di uscire dal <tt>filter</tt> è necessario quindi indicare quale campo rappresenta la <strong>data dell&#8217;evento</strong>, grazie al plugin <strong><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-date.html" rel="noopener noreferrer" target="_blank">date</a></strong>:</p>
<p><pre data-enlighter-language="ruby" class="EnlighterJSRAW">
filter {
  grok {
     ...
  }
  #Replace autogenerated @timestamp with timestamp from grok
  date {
    match =&gt; [ &quot;timestamp&quot; , &quot;yyyy-MM-dd HH:mm:ss.SSS&quot; ]
    timezone =&gt; [ &quot;Europe/Rome&quot; ]
  }
}
</pre></p>
<p>Così diciamo a logstash di generare il campo <tt>@timestamp</tt> (nome di default preso in considerazione per le &#8220;time-series&#8221;) a partire dal campo <tt>timestamp</tt> appena &#8220;grokkato&#8221;, nella timezone &#8220;Europe/Rome&#8221; (perché così è il nostro log).</p>
<p>Infine, come ultimo step, possiamo aggiungere il plugin <tt><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-mutate.html" rel="noopener noreferrer" target="_blank">mutate</a></tt> per specializzare, per esempio, il tipo di un campo:</p>
<p><pre data-enlighter-language="ruby" class="EnlighterJSRAW">
filter {
  grok {
     ...
  }
  date {
    ...
  }
  mutate {
    convert =&gt; {
       &quot;export&quot; =&gt; &quot;boolean&quot;
    }
  }
}
</pre></p>
<p>Per l&#8217;esempio completo del file, vedere <a href="https://github.com/coding-jam/elk-poc/blob/master/conf/filter-output-plain.conf" rel="noopener noreferrer" target="_blank">filter-output-plain.conf</a>.</p>
<h5>Output</h5>
<p>Questo file contiene anche la sezione di <strong>output</strong>: usando il plugin <strong><a href="https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html" rel="noopener noreferrer" target="_blank">elasticsearch</a></strong>, possiamo mandare i log ad ElasticSearch (sul localhost del container):</p>
<p><pre data-enlighter-language="ruby" class="EnlighterJSRAW">
output {
    elasticsearch {
        hosts =&gt; [&quot;localhost&quot;]
        index =&gt; &quot;plain-%{service_name}-%{+yyyy.MM.dd}&quot;
    }
}
</pre></p>
<p>Nel plugin è possibile specificare tutte le istanze di ElasticSearch (<tt>hosts</tt>) e l&#8217;indice da creare (<tt>index</tt>). E&#8217; interessante notare che il nome dell&#8217;indice è variabile: dipende dal campo <tt>service_name</tt> estratto da <strong>grok</strong> (che corrisponde ad un microservizio) e dal giorno corrente. Creare un indice al giorno sembra una prassi ricorrente, perché permette facilmente di eliminare dati più vecchi di una certa data.</p>
<h3>Visualizzare i log</h3>
<p>A questo punto non ci resta che <strong>avviare tutto lo stack</strong>, <strong>inviare dei dati</strong> e poi <strong>aprire Kibana</strong> per vedere i risultati.</p>
<p>Per motivi di test (e di semplicità), applicazione e ElasticStack risiedono sulla stessa macchina: ovviamente, nel mondo reale, Logstash dovrebbe stare con la nostra applicazione, ElasticSearch e Kibana su altre macchine.</p>
<p>Partiamo quindi dall&#8217;applicazione <a href="https://github.com/coding-jam/spring-cloud-poc" rel="noopener noreferrer" target="_blank">Spring Cloud POC</a> (branch <tt>elk-logstash-with-grok-via-fs</tt>) e avviamo tutti i servizi (è importante che il <tt>config-server</tt> e <tt>eureka-server</tt> siano i primi). Nel file README sono specificati tutti i branch e a cosa servono.</p>
<p>Andiamo ora su Elastic Stack: il progetto <a href="https://github.com/coding-jam/elk-poc" rel="noopener noreferrer" target="_blank">elk-poc su GutHub</a> è dockerizzato e ha un <tt>docker-compose.yml</tt> che semplifica l&#8217;avvio dello stack. Per far finta che Logstash sia sulla stessa macchina dell&#8217;applicazione (per poterne collezionare i log), è necessario mappare la cartella dei nostri log come volume nel container, come specificato nel README quando si parla della pipeline <tt>spring-cloud-poc-file-plain</tt>.</p>
<p>Kibana sarà disponibile all&#8217;indirizzo <tt>http://localhost:5601</tt>, ma sarà ancora vuoto e chiede di inserire dati:</p>
<div class="align-center">
<a href="https://codingjam.it/wp-content/uploads/2018/06/kibana-no-data.png" class="lightbox" alt="Kibana add data"><img src="https://codingjam.it/wp-content/uploads/2018/06/kibana-no-data-300x86.png" alt="" width="300" height="86" class="aligncenter size-medium wp-image-15253" srcset="https://codingjam.it/wp-content/uploads/2018/06/kibana-no-data-300x86.png 300w, https://codingjam.it/wp-content/uploads/2018/06/kibana-no-data-768x219.png 768w, https://codingjam.it/wp-content/uploads/2018/06/kibana-no-data-1024x292.png 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>Dopo qualche chiamata a </p>
<pre>
curl http://localhost:8080/api/v1/customers/1/orders
</pre>
<p>potremo creare un nuovo <strong>Index pattern</strong>:</p>
<div class="align-center">
<a href="https://codingjam.it/wp-content/uploads/2018/06/kinana-index-pattern.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/06/kinana-index-pattern-300x124.png" alt="Kibana define index pattern" width="300" height="124" class="aligncenter size-medium wp-image-15254" srcset="https://codingjam.it/wp-content/uploads/2018/06/kinana-index-pattern-300x124.png 300w, https://codingjam.it/wp-content/uploads/2018/06/kinana-index-pattern-768x316.png 768w, https://codingjam.it/wp-content/uploads/2018/06/kinana-index-pattern-1024x422.png 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>che aggregherà tutti gli indici che cominciano con <em>plain</em>, creati automaticamente su ElasticSearch da Logstash. Specifichiamo poi qual è il campo che definisce la data del log:</p>
<div class="align-center">
<a href="https://codingjam.it/wp-content/uploads/2018/06/kibana-index-pattern-timestamp.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/06/kibana-index-pattern-timestamp-300x115.png" alt="Kibana define index pattern timestamp" width="300" height="115" class="aligncenter size-medium wp-image-15255" srcset="https://codingjam.it/wp-content/uploads/2018/06/kibana-index-pattern-timestamp-300x115.png 300w, https://codingjam.it/wp-content/uploads/2018/06/kibana-index-pattern-timestamp-768x295.png 768w, https://codingjam.it/wp-content/uploads/2018/06/kibana-index-pattern-timestamp-1024x394.png 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>ed il gioco è fatto! Dalla voce &#8220;Discover&#8221; possiamo cominciare a definire come vogliamo filtrare e rappresentare la griglia dei log:</p>
<div class="align-center">
<a href="https://codingjam.it/wp-content/uploads/2018/06/kibana-discover.png" class="lightbox" ><img src="https://codingjam.it/wp-content/uploads/2018/06/kibana-discover-300x154.png" alt="Kibana discover" width="300" height="154" class="aligncenter size-medium wp-image-15256" srcset="https://codingjam.it/wp-content/uploads/2018/06/kibana-discover-300x154.png 300w, https://codingjam.it/wp-content/uploads/2018/06/kibana-discover-768x393.png 768w, https://codingjam.it/wp-content/uploads/2018/06/kibana-discover-1024x524.png 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a>
</div>
<p>Grazie alle informazioni aggiunge da Spring Sleuth, filtrare sui valori delle colonne <tt>trace</tt> e <tt>span</tt> ci permettrà di seguire agilmente il percorso fatto da una chiamata attraverso i nostri servizi (<tt>service_name</tt>) e avere sotto controllo l&#8217;intero flusso da un&#8217;unico punto.</p>
<h2>Conclusioni</h2>
<p>In questa prima parte abbiamo esplorato i componenti e i concetti fondamentali di Elastic Stack. La soluzione proposta per aggregare i log è la più semplice che si può realizzare ma molto probabilmente è più adatta ad un ambiente di test che altro. Le possibilità con cui si possono inviare i dati allo stack sono molteplici e nel prossimo post cercheremo di vedere le alternative.</p>
            </div>
            <!-- end content -->

            
      <!-- metadata -->
      <div class="bwp-single-metadata-wrap bwp-no-single-share-and-counters">
        <ul class="bwp-single-metadata list-unstyled clearfix">
                      <!-- author -->
            <li>
              <span class="vcard author">
                <span class="fn">
                  <i class="fa fa-pencil-square-o"></i><a href="../author/andrea-como/index.html" title="Posts by Andrea Como" rel="author">Andrea Como</a>                </span>
              </span>
              <span class="bwp-metadata-slash">/</span>
            </li>
            <!-- end author -->
                                <!-- date -->
            <li>
                            <span class="date updated">
                <i class="fa fa-clock-o"></i><a href="https://codingjam.it/2018/06/19/">19/06/2018</a>
              </span>
              <span class="bwp-metadata-slash">/</span>
            </li>
            <!-- end date -->
                                <!-- categories -->
            <li>
              <i class="fa fa-bookmark-o"></i><a href="../category/tutorial-2/index.html" rel="category tag">Tutorial</a>              <span class="bwp-metadata-slash">/</span>
            </li>
            <!-- end categories -->
                                <!-- tags -->
            <li>
              <i class="fa fa-tags"></i><a href="https://codingjam.it/tag/elasticsearch/" rel="tag">elasticsearch</a>, <a href="https://codingjam.it/tag/elk/" rel="tag">elk</a>, <a href="https://codingjam.it/tag/kibana/" rel="tag">kibana</a>              <span class="bwp-metadata-slash">/</span>
            </li>
            <!-- end tags -->
                  </ul>
      </div>
      <!-- end metadata -->

      
          </div>
          <!-- end content container -->

        </article>
        <!-- end article -->

        
	<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="../17658-2/index.html" rel="prev"><span class="meta-nav"><i class="fa fa-angle-left"></i>Previous post</span><span class="post-title-nav">Previous Post</span></a></div><div class="nav-next"><a href="../scala-2018-luci-ed-ombre/index.html" rel="next"><span class="meta-nav">Next post<i class="fa fa-angle-right"></i></span><span class="post-title-nav">Scala 2018 &#8211; Luci ed ombre</span></a></div></div>
	</nav>
    <!-- about the author -->
    <div class="bwp-about-author-container bwp-transition-3 clearfix">
      <!-- avatar -->
      <div class="bwp-about-author-avatar">
        <a href="../author/andrea-como/index.html">
          <img alt='' src='https://secure.gravatar.com/avatar/684ede46c9386ff5430335a42fd5b011?s=150&amp;d=mm&amp;r=g' srcset='https://secure.gravatar.com/avatar/684ede46c9386ff5430335a42fd5b011?s=300&#038;d=mm&#038;r=g 2x' class='avatar avatar-150 photo' height='150' width='150' />        </a>
      </div>
      <!-- end avatar -->
      <!-- biographical info -->
      <div class="bwp-about-author-bio-wrap">
        <h3 class="bwp-about-author-name">
          <a href="../author/andrea-como/index.html" title="Posts by Andrea Como" rel="author">Andrea Como</a>          <span><i class="fa fa-angle-double-right"></i>84 Posts</span>
        </h3>
        <div class="bwp-about-author-bio">
          Sono un <strong>software engineer</strong> focalizzato nella progettazione e sviluppo di applicazioni web in Java. Presso <a href="http://www.omniagroup.it/">OmniaGroup</a> ricopro il ruolo di <strong>Tech Leader</strong> sulle tecnologie legate alla piattaforma Java EE 5 (come WebSphere 7.0, EJB3, JPA 1 (EclipseLink), JSF 1.2 (Mojarra) e RichFaces 3) e Java EE 6 con JBoss AS 7, in particolare di CDI, JAX-RS, nonché di EJB 3.1, JPA2, JSF2 e RichFaces 4. Al momento mi occupo di ECM, in particolar modo sulla customizzazione di Alfresco 4 e sulla sua installazione con tecnologie da devops come Vagrant e Chef. 
In passato ho lavorato con la piattaforma alternativa alla enterprise per lo sviluppo web: Java SE 6, Tomcat 6, Hibernate 3 e Spring 2.5. Nei ritagli di tempo sviluppo siti web in PHP e ASP. Per maggiori informazioni consulta il mio <a href="http://resume.linkedinlabs.com/qoqlpivm">curriculum pubblico</a>.

<a href="https://twitter.com/andrea_como">Follow me on Twitter</a>  -  <a href="http://www.linkedin.com/pub/andrea-como/19/291/99">LinkedIn profile</a> - <a href="https://plus.google.com/u/0/111647274412905676850/posts?rel=author">Google+</a>        </div>
                  <ul class="bwp-about-author-social list-unstyled clearfix">
                              <li><a href="http://andrea_como/" target="_blank" class="bwp-a-twitter-link"><i class="fa fa-twitter"></i></a></li>
                                  <li><a href="http://www.cosenonjaviste.it/?team=andrea-como" target="_blank" class="bwp-a-website-link"><i class="fa fa-link"></i></a></li>
                          </ul>
              </div>
      <!-- end biographical info -->
    </div>
    <!-- end about the author -->

    
                  </div><!-- /bwp-single-content-col-wrap --></div><!-- /col-md-8 --><div class="col-md-4 bwp-sidebar-col bwp-sidebar-right">
        
                  </div><!-- /col --></div><!-- /row -->
        
      </div>
    </div>
  </section>
  <!-- end blog post - single page -->

  
<!-- footer -->
<footer id="bwp-footer-wrap">
  <div class="container">
    <div class="bwp-footer-container clearfix">

              <!-- footer text -->
        <div class="bwp-footer-text">
          CodingJam        </div>
        <!-- end footer text -->
      
              <!-- social links -->
        <ul class="bwp-footer-social-links list-unstyled clearfix">
          <li><a href="https://twitter.com/codingjam" target="_blank" class="bwp-f-twitter-link"><i class="fa fa-twitter"></i></a></li><li><a href="https://www.facebook.com/codingjamit/" target="_blank" class="bwp-f-facebook-link"><i class="fa fa-facebook"></i></a></li><li><a href="https://github.com/coding-jam" target="_blank" class="bwp-f-github-link"><i class="fa fa-github"></i></a></li>        </ul>
        <!-- end social links -->
      
    </div>
  </div>
</footer>
<!-- end footer -->

<!--googleoff: all--><div id="cookie-law-info-bar"><span>Questo sito Web utilizza i cookie per migliorare la tua esperienza. Daremo per scontato che per te sia ok, ma puoi disattivarlo se lo desideri..<a role='button' tabindex='0' data-cli_action="accept" id="cookie_action_close_header"  class="large cli-plugin-button cli-plugin-main-button cookie_action_close_header cli_action_button" style="display:inline-block; ">Accetto</a>  <a role='button' tabindex='0' id="cookie_action_close_header_reject"  class="large cli-plugin-button cli-plugin-main-button cookie_action_close_header_reject cli_action_button"  data-cli_action="reject">Annulla</a> <a href='../cookie.html' id="CONSTANT_OPEN_URL" target="_blank"  class="cli-plugin-main-link"  style="display:inline-block;" >Read More</a></span></div><div id="cookie-law-info-again" style="display:none;"><span id="cookie_hdr_showagain">Privacy & Cookies</span></div><div class="cli-modal" id="cliSettingsPopup" tabindex="-1" role="dialog" aria-labelledby="cliSettingsPopup" aria-hidden="true">
  <div class="cli-modal-dialog" role="document">
    <div class="cli-modal-content cli-bar-popup">
      <button type="button" class="cli-modal-close" id="cliModalClose">
        <svg class="" viewBox="0 0 24 24"><path d="M19 6.41l-1.41-1.41-5.59 5.59-5.59-5.59-1.41 1.41 5.59 5.59-5.59 5.59 1.41 1.41 5.59-5.59 5.59 5.59 1.41-1.41-5.59-5.59z"></path><path d="M0 0h24v24h-24z" fill="none"></path></svg>
        <span class="wt-cli-sr-only">Close</span>
      </button>
      <div class="cli-modal-body">
        <div class="cli-container-fluid cli-tab-container">
    <div class="cli-row">
        <div class="cli-col-12 cli-align-items-stretch cli-px-0">
            <div class="cli-privacy-overview">
                                                   
                <div class="cli-privacy-content">
                    <div class="cli-privacy-content-text"></div>
                </div>
                <a class="cli-privacy-readmore" data-readmore-text="Show more" data-readless-text="Show less"></a>            </div>
        </div>  
        <div class="cli-col-12 cli-align-items-stretch cli-px-0 cli-tab-section-container">
              
                            <div class="cli-tab-section">
                    <div class="cli-tab-header">
                        <a role="button" tabindex="0" class="cli-nav-link cli-settings-mobile" data-target="necessary" data-toggle="cli-toggle-tab" >
                            Necessary 
                        </a>
                    
                    <span class="cli-necessary-caption">Always Enabled</span>                     </div>
                    <div class="cli-tab-content">
                        <div class="cli-tab-pane cli-fade" data-id="necessary">
                            <p></p>
                        </div>
                    </div>
                </div>
              
                       
        </div>
    </div> 
</div> 
      </div>
    </div>
  </div>
</div>
<div class="cli-modal-backdrop cli-fade cli-settings-overlay"></div>
<div class="cli-modal-backdrop cli-fade cli-popupbar-overlay"></div>
<script type="text/javascript">
  /* <![CDATA[ */
  cli_cookiebar_settings='{"animate_speed_hide":"500","animate_speed_show":"500","background":"#fff","border":"#444","border_on":false,"button_1_button_colour":"#000","button_1_button_hover":"#000000","button_1_link_colour":"#fff","button_1_as_button":true,"button_1_new_win":false,"button_2_button_colour":"#333","button_2_button_hover":"#292929","button_2_link_colour":"#444","button_2_as_button":false,"button_2_hidebar":false,"button_3_button_colour":"#000","button_3_button_hover":"#000000","button_3_link_colour":"#fff","button_3_as_button":true,"button_3_new_win":false,"button_4_button_colour":"#000","button_4_button_hover":"#000000","button_4_link_colour":"#fff","button_4_as_button":true,"font_family":"inherit","header_fix":false,"notify_animate_hide":true,"notify_animate_show":false,"notify_div_id":"#cookie-law-info-bar","notify_position_horizontal":"right","notify_position_vertical":"bottom","scroll_close":false,"scroll_close_reload":false,"accept_close_reload":false,"reject_close_reload":false,"showagain_tab":true,"showagain_background":"#fff","showagain_border":"#000","showagain_div_id":"#cookie-law-info-again","showagain_x_position":"100px","text":"#000","show_once_yn":false,"show_once":"10000","logging_on":false,"as_popup":false,"popup_overlay":true,"bar_heading_text":"","cookie_bar_as":"banner","popup_showagain_position":"bottom-right","widget_position":"left"}';
  /* ]]> */
</script>
<!--googleon: all--><script type='text/javascript' src='../wp-content/themes/melissa/js/bootstrap.min7433.js?ver=3.3.7'></script>
<script type='text/javascript' src='../wp-content/themes/melissa/js/jquery.parallaxc358.js?ver=1.1.3'></script>
<script type='text/javascript' src='../wp-content/themes/melissa/js/superfish.min97e9.js?ver=1.7.9'></script>
<script type='text/javascript' src='../wp-content/themes/melissa/assets/owl-carousel/owl.carousel.min3ba1.js?ver=1.3.3'></script>
<script type='text/javascript' src='../wp-content/themes/melissa/assets/magnific-popup/jquery.magnific-popup.minf488.js?ver=1.1.0'></script>
<script type='text/javascript' src='../wp-content/themes/melissa/js/ie10-viewport-bug-workaround8a54.js?ver=1.0.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var melissaData = {"ajaxURL":"https:\/\/codingjam.it\/wp-admin\/admin-ajax.php","ajaxNonce":"1520cabb4b","templateDirectoryUri":"https:\/\/codingjam.it\/wp-content\/themes\/melissa","isMobile":"false","isSingular":"true","adminBar":"false","headerType":"simple-header","stickyNavigation":"true","isMasonry":"false","masonryColumnWidth":"","infiniteScroll":"false","iScrollLoadMoreBtn":"false","linksTarget":"_self","retinaDataAttr":"false","toTopButton":"true","iScrollLoadingMsg":"Loading new posts...","iScrollFinishedMsg":"No more posts to load","loadMoreBtnText":"Load More"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/melissa/js/themef488.js?ver=1.1.0'></script>
<script type='text/javascript' src='../wp-content/themes/melissa/js/retina.min6f3e.js?ver=1.3.0'></script>
</body>

<!-- Mirrored from codingjam.it/controlla-la-tua-applicazione-spring-cloud-con-elastic-stack-a-k-a-elk-parte-1/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 05 Dec 2020 10:22:24 GMT -->
</html>